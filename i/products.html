<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Products Management</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f4f7f6; }
        .header-box { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #3498db; margin-bottom: 20px; }
        .btn-add { text-decoration: none; background: #2ecc71; color: white; padding: 10px 15px; border-radius: 5px; font-weight: bold; }
        .select-container { margin-bottom: 30px; }
        select { padding: 10px; width: 300px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; }
        #dataDisplay { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .product-info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .info-card { border: 1px solid #eee; padding: 15px; text-align: center; border-radius: 8px; background: #fafafa; }
        .info-card h4 { margin: 0; color: #7f8c8d; font-size: 14px; }
        .info-card p { margin: 10px 0 0; font-size: 20px; font-weight: bold; color: #2c3e50; }
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .file-card {
            background: #ffffff;
            border: 1px solid #ddd;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .file-card:hover {
            background: #3498db;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .file-card.active {
            background: #2ecc71;
            color: white;
            border-color: #27ae60;
        }

        /* টেবিল স্টাইল */
        .table-container {
            overflow-x: auto;
        }
    
        table {
            width: 100%;
            border-collapse: separate; /* বর্ডার যাতে গায়েব না হয় */
            border-spacing: 0;         /* গ্যাপ কমানো */
            border: 1px solid #000;    /* মূল টেবিল বর্ডার */
            margin-top: 10px;
            font-size: 14px;
        }
    
        th, td {
            border: 1px solid #000;
            padding: 12px;
            background-color: #fff; /* ডিফল্ট ব্যাকগ্রাউন্ড সাদা */
            text-align: center;
        }
    
        tr:hover {
            background: #f1f1f1;
        }

        thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            background: #f2f2f2; /* হেডার কালার একটু আলাদা দিলে ভালো দেখায় */
            box-shadow: inset 0 -1px 0 #000, inset 0 1px 0 #000; /* বর্ডার বজায় রাখতে */
        }

        /* ৪. প্রথম কলাম (সদস্য নং / হিসাব নং) স্টিকি করা */
        tbody td:first-child, 
        thead th:first-child {
            position: sticky;
            left: 0;
            z-index: 5;
            background-color: #fff !important; /* স্ক্রল করার সময় পিছনের লেখা দেখা যাবে না */
            box-shadow: inset -1px 0 0 #000; /* ডানে বর্ডার দেখানোর জন্য shadow ব্যবহার */
        }

        /* ৫. কোণার সেলটি (Top-Left) যাতে সবার উপরে থাকে */
        thead tr:first-child>th:first-child {
            z-index: 15;
        }
        thead th:first-child{
            background-color: #f2f2f2 !important;
        }

        /* হোভার ইফেক্ট যাতে স্টিকি সেলেও কাজ করে */
        tr:hover td {
            background-color: #f1f1f1 !important;
        }
    </style>
</head>
<body>

    <div class="header-box">
        <h2>Product Database</h2>
        <a href="productAdd.html" class="btn-add">+ Add New Product</a>
    </div>

    <div class="select-container">
        <label>Select Product: </label>
        <select id="productSelector" onchange="fetchProductFiles()">
            <option value="">-- Choose Product --</option>
        </select>
    </div>

    <div class="header-box">
        <h2></span id="productName"></span> গ্রাহক লেজার</h2>
        <a href="productCustomerAdd.html" class="btn-add">+ নতুন গ্রাহক যোগ করুন</a>
    </div>

    <div id="dataDisplay">
        <div id="fileListArea" class="file-list" style="margin-top: 20px;"></div>

        <div id="summaryArea" class="table-container">
            <h3>Summary Data (<span id="currentFileName"></span>)</h3>
            <table>
                <thead>
                    <tr>
                        <th>গ্রাহক নং</th>
                        <th>গ্রাহকের নাম</th>
                        <th>গ্রাহকের পিতা/স্বামীর নাম</th>
                        <th>সর্বমোট জমা</th>
                    </tr>
                </thead>
                <tbody id="summaryTableBody">
                    </tbody>
            </table>
        </div>

        <div id="LedgerDisplayArea" style="display:none; margin-top: 30px;"></div>
    </div>

    <script src="API.js"></script>
    <script src="getRequest.js"></script>
    <script src="ledgerGenerator.js"></script>

    <script>
        // Page load hoyar shathey shathey list fetch kora
        window.onload = async () => {
            const result = await universalGetRequest('getProductList');
            if (result.status === "success") {
                const selector = document.getElementById('productSelector');
                result.data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.name;
                    option.text = item.name + (item.type === 'folder' ? ' (F)' : ' (S)');
                    selector.add(option);
                });
            }
        };

        // ১. প্রোডাক্ট সিলেক্ট করলে ফাইল লিস্ট (১০০, ২০০) নিয়ে আসবে
        // Product select korle file list fetch hobe
        async function fetchProductFiles() {
            const productName = document.getElementById('productSelector').value;
            if (!productName) return;
        
            const fileListArea = document.getElementById('fileListArea');
            fileListArea.innerHTML = "Loading files...";
        
            const result = await universalGetRequest('getProductsFileList', { productName: productName });

            if (result.status === "success") {
                fileListArea.innerHTML = "";
                result.data.forEach(fileName => {
                    const card = document.createElement('div');
                    card.className = 'file-card'; // member.html er moto style
                    card.innerText = fileName;
                    card.onclick = () => fetchSummaryData(productName, fileName);
                    fileListArea.appendChild(card);
                });
            }
        }
        
        // ২. নির্দিষ্ট ফাইলে ক্লিক করলে ওই ফাইলের কাস্টমারদের সামারি আনা
        async function fetchSummaryData(productName, fileName) {
            document.getElementById('currentFileName').innerText = fileName;
            const tbody = document.getElementById('summaryTableBody');
            tbody.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';
            document.getElementById('summaryArea').style.display = 'block';

            const result = await universalGetRequest('getProductsSummaryData', { 
                productName: productName, 
                fileName: fileName 
            });
        
            if (result.status === "success") {
                tbody.innerHTML = '';
                result.data.forEach(row => {
                    const tr = document.createElement('tr');

                    // LedgerGenerator.js er jonno info object
                    const info = JSON.stringify({ 
                        customerType: 'products', 
                        customerNumber: row.customerNo,
                        productName: productName,
                        customerFile: fileName
                    });
                
                    tr.innerHTML = `
                        <td><b style="color: #3498db; cursor: pointer;" onclick='getLedger(${info})'>${row.customerNo}</b></td>
                        <td>${row.customerName}</td>
                        <td>${row.fatherOrHusbandName}</td>
                        <td style="font-weight:bold;">${row.totalBalance}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }
    </script>
</body>
</html>